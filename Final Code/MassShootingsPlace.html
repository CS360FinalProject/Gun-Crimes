<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: Scaling the circles by data value</title>
		<script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
		<style type="text/css">
			/* No style rules here yet */
		</style>
	</head>
	<body>
		<script type="text/javascript">

  var width = 1000;
  var height = 600;

  var projection = d3.geoAlbersUsa()
  .translate([width/2, height/2])
  .scale([500]);

  var path = d3.geoPath()
  .projection(projection);

  var color = d3.scaleQuantize()
  .range(["rgb(237,248,233)","rgb(186,228,179)","rgb(116,196,118)","rgb(49,163,84)","rgb(0,109,44)"]);

  var svg = d3.select("body")
  .append("svg")
  .attr("width", width)
  .attr("height", height);

  d3.csv("MassShooting.csv", function(data) {
    //Set input domain for color scale
    color.domain([
      d3.min(data, function(d) { return d.Fatalities; }),
      d3.max(data, function(d) { return d.Fatalities; })
    ]);

    d3.json("data.json", function (json) {
      for(var i = 0; i < data.length; i++) {
        var dataCity = data[i].Cities;
        var dataValue = data[i].Fatalities;

        for(var j = 0; j < json.features.length; j++) {
          var jsonState = json.features[j].properties.name;

          if(data.state == jsonState) {
            json.features[j].properties.value = dataValue;

            break;
          }
        }
      }

      svg.select("path")
      .data(json.features)
      .enter()
      .append("path")
      .attr("d",path)
      .style("fill",function(d) {
        var value = d.properties.value;

        if(value) {
          return color(value);
        } else {
          return "#ccc";
        }
      });
      d3.csv("MassShooting.csv", function (data) {
        svg.selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
        .attr("cx", function (d) {
          return projection([d.longitude, d.latitude])[0];
        })
        .attr("cy", function(d) {
          return projection([d.longitude, d.latitude])[1];
        })
        .attr("r", function(d) {
          return Math.sqrt(parseInt(d.Fatalities));
        })
        .style("fill","yellow")
        .style("stroke","gray")
        .style("stroke-width",0.25)
        .style("opacity",0.75)
        .append("title")
        .text(function (d) {
          return d.Cities + ": Summary. " + d.Summary;
        });

    });
  });

});

  </script>
</body>
</html>
